import{FaceMesh as I}from"@mediapipe/face_mesh";import"@tensorflow/tfjs";(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const o of e)if(o.type==="childList")for(const h of o.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&m(h)}).observe(document,{childList:!0,subtree:!0});function i(e){const o={};return e.integrity&&(o.integrity=e.integrity),e.referrerPolicy&&(o.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?o.credentials="include":e.crossOrigin==="anonymous"?o.credentials="omit":o.credentials="same-origin",o}function m(e){if(e.ep)return;e.ep=!0;const o=i(e);fetch(e.href,o)}})();const D="/los-planetas/assets/space_helmet_1-DDP7PoAW.png",E="/los-planetas/assets/frame-B_Zca0a3.webp";window.onload=()=>{F().then(P)};const f=new Image;f.src=D;const O=new Image;O.src=E;const t=document.querySelector("canvas");t.style.width="100%";t.style.height="100%";const a=document.createElement("video");async function F(){const g=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:3840},height:{ideal:2160}}});a.srcObject=g,a.autoplay=!0,a.onloadedmetadata=()=>{t.width=a.videoWidth,t.height=a.videoHeight};const c=new I({locateFile:n=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${n}`});c.setOptions({maxNumFaces:5,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),c.onResults(m);const i=t.getContext("2d");function m(n){i.clearRect(0,0,t.width,t.height),i.drawImage(a,0,0,t.width,t.height),e(n.multiFaceLandmarks),i.drawImage(O,0,0,t.width,t.height)}function e(n){n&&n.forEach(s=>{const r=o(s);h(r,s)})}function o(n){const s=n.map(d=>d.x*t.width),r=n.map(d=>d.y*t.height),l=Math.min(...s),u=Math.min(...r),p=Math.max(...s)-l,y=Math.max(...r)-u;return{x:l,y:u,width:p,height:y}}function h(n,s){const{x:r,y:l,width:u,height:p}=n,y=4.6,d=s[33],x=s[263],w=Math.sqrt(Math.pow((x.x-d.x)*t.width,2)+Math.pow((x.y-d.y)*t.height,2))*y,L=f.width/f.height,M=w/L;i.drawImage(f,r+u/2-w/2,l+p/2-M/2,w,M)}async function v(){await c.send({image:a}),requestAnimationFrame(v)}v()}function P(){document.querySelector("#trigger").addEventListener("click",()=>{document.querySelector("audio").play();const c=t.toDataURL("image/png"),i=document.createElement("a");i.href=c,i.download="photo.png",i.click()})}
