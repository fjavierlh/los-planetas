(function(){const c=document.createElement("link").relList;if(c&&c.supports&&c.supports("modulepreload"))return;for(const e of document.querySelectorAll('link[rel="modulepreload"]'))m(e);new MutationObserver(e=>{for(const n of e)if(n.type==="childList")for(const h of n.addedNodes)h.tagName==="LINK"&&h.rel==="modulepreload"&&m(h)}).observe(document,{childList:!0,subtree:!0});function i(e){const n={};return e.integrity&&(n.integrity=e.integrity),e.referrerPolicy&&(n.referrerPolicy=e.referrerPolicy),e.crossOrigin==="use-credentials"?n.credentials="include":e.crossOrigin==="anonymous"?n.credentials="omit":n.credentials="same-origin",n}function m(e){if(e.ep)return;e.ep=!0;const n=i(e);fetch(e.href,n)}})();window.onload=()=>{I().then(E)};const g=new Image;g.src="/img/space_helmet_1.png";const O=new Image;O.src="/img/frame.webp";const t=document.querySelector("canvas");t.style.width="100%";t.style.height="100%";const a=document.createElement("video");async function I(){const f=await navigator.mediaDevices.getUserMedia({video:{facingMode:"user",width:{ideal:3840},height:{ideal:2160}}});a.srcObject=f,a.autoplay=!0,a.onloadedmetadata=()=>{t.width=a.videoWidth,t.height=a.videoHeight};const c=new FaceMesh({locateFile:o=>`https://cdn.jsdelivr.net/npm/@mediapipe/face_mesh/${o}`});c.setOptions({maxNumFaces:5,refineLandmarks:!0,minDetectionConfidence:.5,minTrackingConfidence:.5}),c.onResults(m);const i=t.getContext("2d");function m(o){i.clearRect(0,0,t.width,t.height),i.drawImage(a,0,0,t.width,t.height),e(o.multiFaceLandmarks),i.drawImage(O,0,0,t.width,t.height)}function e(o){o&&o.forEach(r=>{const s=n(r);h(s,r)})}function n(o){const r=o.map(d=>d.x*t.width),s=o.map(d=>d.y*t.height),u=Math.min(...r),l=Math.min(...s),p=Math.max(...r)-u,y=Math.max(...s)-l;return{x:u,y:l,width:p,height:y}}function h(o,r){const{x:s,y:u,width:l,height:p}=o,y=4.6,d=r[33],x=r[263],w=Math.sqrt(Math.pow((x.x-d.x)*t.width,2)+Math.pow((x.y-d.y)*t.height,2))*y,L=g.width/g.height,M=w/L;i.drawImage(g,s+l/2-w/2,u+p/2-M/2,w,M)}async function v(){await c.send({image:a}),requestAnimationFrame(v)}v()}function E(){document.querySelector("#trigger").addEventListener("click",()=>{document.querySelector("audio").play();const c=t.toDataURL("image/png"),i=document.createElement("a");i.href=c,i.download="photo.png",i.click()})}
